<h2 class="mb-2">Reporte de movimientos</h2>

<!-- Card de filtros -->
<div class="card report-card">
  <form [formGroup]="f" (ngSubmit)="consultar()" class="report-filters" novalidate>
    <!-- Cliente -->
    <div class="field">
      <label for="client">Cliente</label>
      <select id="client" formControlName="clientId">
        <option value="" disabled>-- Selecciona cliente --</option>
        <option *ngFor="let c of clientes" [value]="c.id">{{ c.name }}</option>
      </select>
    </div>

    <!-- Desde -->
    <div class="field">
      <label for="desde">Desde</label>
      <input id="desde" type="date" formControlName="desde" />
    </div>

    <!-- Hasta -->
    <div class="field">
      <label for="hasta">Hasta</label>
      <input id="hasta" type="date" formControlName="hasta" />
    </div>

    <!-- Acciones -->
    <div class="actions">
      <button class="btn btn-primary" type="submit" [disabled]="f.invalid || loading">
        {{ loading ? 'Consultandoâ€¦' : 'Consultar' }}
      </button>
      <div class="divider"></div>
      <button class="btn" type="button" (click)="exportCsv()" [disabled]="!rows.length || loading">
        Exportar CSV
      </button>
    </div>
  </form>
</div>

<!-- Loader -->
<div *ngIf="loading" class="loader">
  <div class="spinner" aria-hidden="true"></div>
  <span>Consultando datosâ€¦</span>
</div>

<!-- Tabla -->
<div class="table-wrap" *ngIf="!loading && rows.length; else emptyTpl">
  <table class="table">
    <thead>
      <tr>
        <th style="min-width:140px;">Fecha</th>
        <th style="min-width:160px;">Cliente</th>
        <th>NÂ° Cuenta</th>
        <th>Tipo</th>
        <th class="num">Saldo inicial</th>
        <th>Estado</th>
        <th class="num">Movimiento</th>
        <th class="num">Saldo disponible</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of rows">
        <td>{{ r.fecha | date:'yyyy-MM-dd HH:mm' }}</td>
        <td>{{ r.cliente }}</td>
        <td>{{ r.numeroCuenta }}</td>
        <td>
          <span class="badge" [ngClass]="r.tipo === 'CrÃ©dito' || r.tipo === 'Credito' ? 'badge-green' : 'badge-amber'">
            {{ r.tipo }}
          </span>
        </td>
        <td class="num">{{ r.saldoInicial | number:'1.2-2' }}</td>
        <td>
          <span class="badge" [ngClass]="r.estado ? 'badge-blue' : 'badge-gray'">
            {{ r.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
        <td class="num" [ngClass]="(r.movimiento ?? 0) >= 0 ? 'pos' : 'neg'">
          {{ r.movimiento | number:'1.2-2' }}
        </td>
        <td class="num">{{ r.saldoDisponible | number:'1.2-2' }}</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Empty state -->
<ng-template #emptyTpl>
  <div class="empty card">
    <div class="empty-icon" aria-hidden="true">ðŸ“„</div>
    <h3>Sin resultados</h3>
    <p>Selecciona un cliente y un rango de fechas, luego presiona <strong>Consultar</strong>.</p>
  </div>
</ng-template>